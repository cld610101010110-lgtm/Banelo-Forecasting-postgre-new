{% extends 'accounts/base.html' %}
{% load static %}
{% block title %}Waste Tracking - Banelo Coffee POS{% endblock %}

{% block extra_css %}
<style>
     * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
     }

     body {
         font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
         background-color: #F5F5F5;
         overflow-x: hidden;
     }

     /* Sidebar Styles */
     .sidebar {
         position: fixed;
         top: 0;
         left: 0;
         height: 100vh;
         width: 250px;
         background: linear-gradient(180deg, #3E2723 0%, #4E342E 100%);
         color: white;
         transition: all 0.3s ease;
         z-index: 1000;
         overflow-y: auto;
     }

     .sidebar.collapsed {
         width: 70px;
     }

     .sidebar-header {
         padding: 20px 15px;
         border-bottom: 1px solid rgba(255, 255, 255, 0.1);
         display: flex;
         align-items: center;
         justify-content: space-between;
     }

     .logo-container {
         display: flex;
         align-items: center;
         gap: 10px;
     }

     .logo-icon {
         width: 40px;
         height: 40px;
         border-radius: 50%;
         flex-shrink: 0;
         object-fit: cover;
         background: white;
         padding: 5px;
     }

     .logo-text {
         font-weight: 600;
         font-size: 18px;
         white-space: nowrap;
         transition: opacity 0.3s;
     }

     .sidebar.collapsed .logo-text {
         opacity: 0;
         display: none;
     }

     .burger-btn {
         background: none;
         border: none;
         color: white;
         font-size: 20px;
         cursor: pointer;
         padding: 5px;
         transition: transform 0.3s;
     }

     .burger-btn:hover {
         transform: scale(1.1);
     }

     .sidebar-menu {
         list-style: none;
         padding: 20px 0;
     }

     .menu-item {
         margin: 5px 0;
     }

     .menu-link {
         display: flex;
         align-items: center;
         padding: 15px 20px;
         color: rgba(255, 255, 255, 0.8);
         text-decoration: none;
         transition: all 0.3s;
         gap: 15px;
     }

     .menu-link:hover {
         background: rgba(255, 255, 255, 0.1);
         color: white;
     }

     .menu-link.active {
         background: #D84315;
         color: white;
         border-left: 4px solid #FF6F00;
     }

     .menu-icon {
         font-size: 20px;
         width: 20px;
         text-align: center;
         flex-shrink: 0;
     }

     .menu-text {
         white-space: nowrap;
         transition: opacity 0.3s;
     }

     .sidebar.collapsed .menu-text {
         opacity: 0;
         display: none;
     }

     /* Submenu Styles */
     .submenu-arrow {
         margin-left: auto;
         font-size: 12px;
         transition: transform 0.3s;
     }

     .menu-link.active .submenu-arrow {
         transform: rotate(180deg);
     }

     .submenu {
         list-style: none;
         padding: 0;
         margin: 0;
         max-height: 0;
         overflow: hidden;
         transition: max-height 0.3s ease;
         background: rgba(0, 0, 0, 0.2);
     }

     .submenu.active {
         max-height: 500px;
     }

     .submenu-item {
         margin: 0;
     }

     .submenu-link {
         display: flex;
         align-items: center;
         padding: 12px 20px 12px 55px;
         color: rgba(255, 255, 255, 0.7);
         text-decoration: none;
         transition: all 0.3s;
         gap: 10px;
         font-size: 14px;
     }

     .submenu-link:hover {
         background: rgba(255, 255, 255, 0.05);
         color: white;
     }

     .submenu-link.active {
         background: rgba(255, 111, 0, 0.3);
         color: white;
         border-left: 3px solid #FF6F00;
     }

     .logout-section {
         position: absolute;
         bottom: 0;
         width: 100%;
         padding: 20px;
         border-top: 1px solid rgba(255, 255, 255, 0.1);
     }

     .logout-btn {
         width: 100%;
         padding: 12px;
         background: rgba(255, 255, 255, 0.1);
         border: none;
         color: white;
         border-radius: 8px;
         cursor: pointer;
         transition: all 0.3s;
         display: flex;
         align-items: center;
         justify-content: center;
         gap: 10px;
         font-size: 15px;
     }

     .logout-btn:hover {
         background: #D32F2F;
     }

     .sidebar.collapsed .logout-text {
         display: none;
     }

     /* Main Content */
     .main-content {
         margin-left: 250px;
         padding: 20px;
         transition: margin-left 0.3s ease;
         min-height: 100vh;
     }

     .sidebar.collapsed + .main-content {
         margin-left: 70px;
     }

     /* Top Bar */
     .top-bar {
         background: white;
         padding: 20px 30px;
         border-radius: 12px;
         box-shadow: 0 2px 8px rgba(0,0,0,0.05);
         margin-bottom: 30px;
         display: flex;
         justify-content: space-between;
         align-items: center;
         flex-wrap: wrap;
         gap: 20px;
     }

     .page-title-container {
         display: flex;
         align-items: center;
         gap: 15px;
     }

     .page-icon {
         width: 50px;
         height: 50px;
         background: linear-gradient(135deg, #D32F2F 0%, #E57373 100%);
         border-radius: 12px;
         display: flex;
         align-items: center;
         justify-content: center;
         font-size: 24px;
         color: white;
     }

     .page-title {
         font-size: 28px;
         font-weight: 600;
         color: #3E2723;
     }

     .user-info {
         display: flex;
         align-items: center;
         gap: 10px;
         padding: 10px 15px;
         background: #F5F5F5;
         border-radius: 25px;
     }

     .user-avatar {
         width: 35px;
         height: 35px;
         border-radius: 50%;
         background: #D84315;
         display: flex;
         align-items: center;
         justify-content: center;
         color: white;
         font-weight: 600;
     }

     .user-name {
         font-weight: 500;
         color: #3E2723;
     }

     /* Filter Section */
     .filter-section {
         background: white;
         padding: 25px;
         border-radius: 12px;
         box-shadow: 0 2px 8px rgba(0,0,0,0.05);
         margin-bottom: 30px;
     }

     .filter-header {
         font-size: 18px;
         font-weight: 600;
         color: #3E2723;
         margin-bottom: 20px;
         display: flex;
         align-items: center;
         gap: 10px;
     }

     .filter-form {
         display: flex;
         gap: 15px;
         align-items: end;
         flex-wrap: wrap;
     }

     .filter-group {
         flex: 1;
         min-width: 200px;
     }

     .filter-label {
         display: block;
         font-size: 14px;
         font-weight: 500;
         color: #666;
         margin-bottom: 8px;
     }

     .filter-input {
         width: 100%;
         padding: 12px;
         border: 1px solid #DDD;
         border-radius: 8px;
         font-size: 14px;
         transition: all 0.3s;
     }

     .filter-input:focus {
         outline: none;
         border-color: #D84315;
         box-shadow: 0 0 0 3px rgba(216, 67, 21, 0.1);
     }

     .filter-btn {
         padding: 12px 30px;
         background: linear-gradient(135deg, #D84315 0%, #FF6F00 100%);
         color: white;
         border: none;
         border-radius: 8px;
         cursor: pointer;
         font-size: 14px;
         font-weight: 500;
         transition: all 0.3s;
         display: flex;
         align-items: center;
         gap: 8px;
     }

     .filter-btn:hover {
         transform: translateY(-2px);
         box-shadow: 0 4px 12px rgba(216, 67, 21, 0.3);
     }

     .clear-filter-btn {
         padding: 12px 30px;
         background: white;
         color: #666;
         border: 1px solid #DDD;
         border-radius: 8px;
         cursor: pointer;
         font-size: 14px;
         font-weight: 500;
         transition: all 0.3s;
     }

     .clear-filter-btn:hover {
         background: #F5F5F5;
         border-color: #999;
     }

     /* Summary Cards */
     .summary-cards {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
         gap: 20px;
         margin-bottom: 30px;
     }

     .summary-card {
         background: white;
         padding: 25px;
         border-radius: 12px;
         box-shadow: 0 2px 8px rgba(0,0,0,0.05);
         display: flex;
         align-items: center;
         gap: 20px;
         transition: all 0.3s;
     }

     .summary-card:hover {
         transform: translateY(-3px);
         box-shadow: 0 4px 16px rgba(0,0,0,0.1);
     }

     .summary-icon {
         width: 60px;
         height: 60px;
         border-radius: 12px;
         display: flex;
         align-items: center;
         justify-content: center;
         font-size: 28px;
         color: white;
     }

     .summary-icon.red {
         background: linear-gradient(135deg, #D32F2F 0%, #E57373 100%);
     }

     .summary-icon.blue {
         background: linear-gradient(135deg, #1976D2 0%, #64B5F6 100%);
     }

     .summary-icon.green {
         background: linear-gradient(135deg, #388E3C 0%, #81C784 100%);
     }

     .summary-details {
         flex: 1;
     }

     .summary-label {
         font-size: 14px;
         color: #666;
         margin-bottom: 5px;
     }

     .summary-value {
         font-size: 28px;
         font-weight: 700;
         color: #3E2723;
     }

     /* Waste Table */
     .waste-table-container {
         background: white;
         padding: 25px;
         border-radius: 12px;
         box-shadow: 0 2px 8px rgba(0,0,0,0.05);
         overflow-x: auto;
     }

     .table-header {
         font-size: 18px;
         font-weight: 600;
         color: #3E2723;
         margin-bottom: 20px;
         display: flex;
         align-items: center;
         gap: 10px;
     }

     .waste-table {
         width: 100%;
         border-collapse: collapse;
     }

     .waste-table thead {
         background: #F5F5F5;
     }

     .waste-table th {
         padding: 15px;
         text-align: left;
         font-weight: 600;
         color: #3E2723;
         font-size: 14px;
         border-bottom: 2px solid #DDD;
     }

     .waste-table td {
         padding: 15px;
         border-bottom: 1px solid #EEE;
         font-size: 14px;
         color: #666;
     }

     .waste-table tbody tr:hover {
         background: #F9F9F9;
     }

     .reason-badge {
         display: inline-block;
         padding: 5px 12px;
         border-radius: 20px;
         font-size: 12px;
         font-weight: 500;
     }

     .reason-expired {
         background: #FFEBEE;
         color: #C62828;
     }

     .reason-damaged {
         background: #FFF3E0;
         color: #E65100;
     }

     .reason-spoiled {
         background: #F3E5F5;
         color: #6A1B9A;
     }

     .reason-contaminated {
         background: #E1F5FE;
         color: #01579B;
     }

     .reason-other {
         background: #F5F5F5;
         color: #424242;
     }

     .cost-text {
         font-weight: 600;
         color: #D32F2F;
     }

     .category-badge {
         display: inline-block;
         padding: 4px 10px;
         border-radius: 12px;
         font-size: 12px;
         font-weight: 500;
         background: #E3F2FD;
         color: #1976D2;
     }

     /* Daily Cost Section */
     .daily-cost-section {
         background: white;
         padding: 25px;
         border-radius: 12px;
         box-shadow: 0 2px 8px rgba(0,0,0,0.05);
         margin-bottom: 30px;
     }

     .daily-cost-header {
         font-size: 18px;
         font-weight: 600;
         color: #3E2723;
         margin-bottom: 20px;
         display: flex;
         align-items: center;
         gap: 10px;
     }

     .daily-cost-grid {
         display: grid;
         grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
         gap: 15px;
     }

     .daily-cost-card {
         padding: 15px;
         background: linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 100%);
         border-radius: 8px;
         border-left: 4px solid #D32F2F;
     }

     .daily-cost-date {
         font-size: 14px;
         color: #666;
         margin-bottom: 5px;
     }

     .daily-cost-value {
         font-size: 20px;
         font-weight: 700;
         color: #D32F2F;
     }

     /* Empty State */
     .empty-state {
         text-align: center;
         padding: 60px 20px;
         color: #999;
     }

     .empty-state i {
         font-size: 64px;
         margin-bottom: 20px;
         color: #DDD;
     }

     .empty-state-text {
         font-size: 18px;
         margin-bottom: 10px;
     }

     .empty-state-subtext {
         font-size: 14px;
         color: #BBB;
     }

     /* Responsive */
     @media (max-width: 768px) {
         .sidebar {
             transform: translateX(-100%);
         }

         .sidebar.active {
             transform: translateX(0);
         }

         .main-content {
             margin-left: 0;
         }

         .summary-cards {
             grid-template-columns: 1fr;
         }

         .filter-form {
             flex-direction: column;
         }

         .filter-group {
             width: 100%;
         }

         .waste-table-container {
             overflow-x: scroll;
         }
     }
</style>
{% endblock %}

{% block content %}
<!-- Sidebar -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div class="logo-container">
            <img src="{% static 'images/banelologo.png' %}" alt="Banelo Coffee Logo" class="logo-icon">
            <span class="logo-text">Banelo</span>
        </div>
        <button class="burger-btn" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
    </div>

    <ul class="sidebar-menu">
        <li class="menu-item">
            <a href="{% url 'dashboard' %}" class="menu-link">
                <i class="fas fa-home menu-icon"></i>
                <span class="menu-text">Overview</span>
            </a>
        </li>

        <!-- Inventory with Dropdown -->
        <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link active" onclick="toggleSubmenu('inventorySubmenu')">
                <i class="fas fa-box menu-icon"></i>
                <span class="menu-text">Inventory</span>
                <i class="fas fa-chevron-down submenu-arrow"></i>
            </a>
            <ul class="submenu active" id="inventorySubmenu">
                <li class="submenu-item">
                    <a href="{% url 'inventory' %}" class="submenu-link">
                        <i class="fas fa-list"></i>
                        <span>Inventory List</span>
                    </a>
                </li>
                <li class="submenu-item">
                    <a href="{% url 'recipes' %}" class="submenu-link">
                        <i class="fas fa-mortar-pestle"></i>
                        <span>Recipe Management</span>
                    </a>
                </li>
                <li class="submenu-item">
                    <a href="{% url 'inventory_forecasting' %}" class="submenu-link">
                        <i class="fas fa-chart-bar"></i>
                        <span>Inventory Forecasting</span>
                    </a>
                </li>
                <li class="submenu-item">
                    <a href="{% url 'waste_tracking' %}" class="submenu-link active">
                        <i class="fas fa-trash-alt"></i>
                        <span>Waste Tracking</span>
                    </a>
                </li>
            </ul>
        </li>

        <!-- Sales with Dropdown -->
        <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link" onclick="toggleSubmenu('salesSubmenu')">
                <i class="fas fa-dollar-sign menu-icon"></i>
                <span class="menu-text">Sales</span>
                <i class="fas fa-chevron-down submenu-arrow"></i>
            </a>
            <ul class="submenu" id="salesSubmenu">
                <li class="submenu-item">
                    <a href="{% url 'sales' %}" class="submenu-link">
                        <i class="fas fa-receipt"></i>
                        <span>Sales Records</span>
                    </a>
                </li>
                <li class="submenu-item">
                    <a href="#" class="submenu-link">
                        <i class="fas fa-chart-line"></i>
                        <span>Sales Forecasting</span>
                    </a>
                </li>
            </ul>
        </li>

        <li class="menu-item">
            <a href="{% url 'accounts' %}" class="menu-link">
                <i class="fas fa-users menu-icon"></i>
                <span class="menu-text">Accounts</span>
            </a>
        </li>

        <li class="menu-item">
            <a href="{% url 'audit_trail' %}" class="menu-link">
                <i class="fas fa-clipboard-list menu-icon"></i>
                <span class="menu-text">Audit Trail</span>
            </a>
        </li>

        <li class="menu-item">
            <a href="{% url 'settings' %}" class="menu-link">
                <i class="fas fa-cog menu-icon"></i>
                <span class="menu-text">Settings</span>
            </a>
        </li>
    </ul>

    <div class="logout-section">
        <form method="POST" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span class="logout-text">Log Out</span>
            </button>
        </form>
    </div>
</div>

<!-- Main Content -->
<div class="main-content" id="mainContent">
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="page-title-container">
            <div class="page-icon">
                <i class="fas fa-trash-alt"></i>
            </div>
            <h1 class="page-title">Waste Tracking</h1>
        </div>
        <div class="user-info">
            <div class="user-avatar">{{ request.user.username|slice:":1"|upper }}</div>
            <span class="user-name">{{ request.user.username }}</span>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <h2 class="filter-header">
            <i class="fas fa-filter"></i>
            Filter by Date
        </h2>
        <form class="filter-form" method="GET" action="{% url 'waste_tracking' %}">
            <div class="filter-group">
                <label class="filter-label">From Date</label>
                <input type="date" name="from_date" class="filter-input" value="{{ from_date }}">
            </div>
            <div class="filter-group">
                <label class="filter-label">To Date</label>
                <input type="date" name="to_date" class="filter-input" value="{{ to_date }}">
            </div>
            <button type="submit" class="filter-btn">
                <i class="fas fa-search"></i>
                Apply Filter
            </button>
            <a href="{% url 'waste_tracking' %}" class="clear-filter-btn">
                <i class="fas fa-times"></i>
                Clear Filter
            </a>
        </form>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards">
        <div class="summary-card">
            <div class="summary-icon red">
                <i class="fas fa-coins"></i>
            </div>
            <div class="summary-details">
                <div class="summary-label">Total Waste Cost</div>
                <div class="summary-value">₱{{ total_waste_cost|floatformat:2 }}</div>
            </div>
        </div>
        <div class="summary-card">
            <div class="summary-icon blue">
                <i class="fas fa-list"></i>
            </div>
            <div class="summary-details">
                <div class="summary-label">Total Entries</div>
                <div class="summary-value">{{ entry_count }}</div>
            </div>
        </div>
        <div class="summary-card">
            <div class="summary-icon green">
                <i class="fas fa-calendar-day"></i>
            </div>
            <div class="summary-details">
                <div class="summary-label">Days Tracked</div>
                <div class="summary-value">{{ daily_costs|length }}</div>
            </div>
        </div>
    </div>

    <!-- Daily Cost Breakdown -->
    {% if daily_costs %}
    <div class="daily-cost-section">
        <h2 class="daily-cost-header">
            <i class="fas fa-calendar-alt"></i>
            Daily Waste Cost Breakdown
        </h2>
        <div class="daily-cost-grid">
            {% for daily in daily_costs %}
            <div class="daily-cost-card">
                <div class="daily-cost-date">{{ daily.date }}</div>
                <div class="daily-cost-value">₱{{ daily.cost|floatformat:2 }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Waste Table -->
    <div class="waste-table-container">
        <h2 class="table-header">
            <i class="fas fa-table"></i>
            Waste Log Entries
        </h2>

        {% if waste_entries %}
        <table class="waste-table">
            <thead>
                <tr>
                    <th>Date & Time</th>
                    <th>Product Name</th>
                    <th>Category</th>
                    <th>Quantity</th>
                    <th>Reason</th>
                    <th>Recorded By</th>
                    <th>Waste Cost</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in waste_entries %}
                <tr>
                    <td>{{ entry.wasteDate }}</td>
                    <td><strong>{{ entry.productName }}</strong></td>
                    <td><span class="category-badge">{{ entry.category|title }}</span></td>
                    <td>{{ entry.quantity }}</td>
                    <td>
                        <span class="reason-badge reason-{{ entry.reason|lower }}">
                            {{ entry.reason }}
                        </span>
                    </td>
                    <td>{{ entry.recordedBy }}</td>
                    <td class="cost-text">₱{{ entry.wasteCost|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <div class="empty-state-text">No waste entries found</div>
            <div class="empty-state-subtext">
                {% if from_date or to_date %}
                    Try adjusting your date filters
                {% else %}
                    No waste has been recorded yet
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('collapsed');
}

function toggleSubmenu(submenuId) {
    const submenu = document.getElementById(submenuId);
    submenu.classList.toggle('active');
}

// Auto-expand active submenu on page load
document.addEventListener('DOMContentLoaded', function() {
    const activeSubmenuLink = document.querySelector('.submenu-link.active');
    if (activeSubmenuLink) {
        const parentSubmenu = activeSubmenuLink.closest('.submenu');
        if (parentSubmenu) {
            parentSubmenu.classList.add('active');
        }
    }
});
</script>
{% endblock %}
